---
title: "Parallelization try"
author: "Vincyane Badouard"
date: "29/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# libraries
```{r}
library(Maria)
library(parallel)
```

# data
```{r}
data(Paracou6_2016)
inventory <- Paracou6_2016
iter = 2
cores = 2
```

# Toy function
```{r}
rep <- function(iter, size) {replicate(iter, sample(1:4, size = size), simplify = F)}
rep(2, 2)
```

# lapply
```{r}
lapply(seq_len(3), rep, 2)
lapply(seq_len(3), function(x) sample(1:4))
lapply(seq_len(3), function(x) inventorycheckformat(inventory))

```

```{r}
cl <- makePSOCKcluster(getOption("cl.cores", cores)) # create a cluster

clusterExport(cl = cl, varlist = "inventory", envir = environment()) # cluster environment

parLapply(cl, seq_len(iter), function(x) sample(1:4))
parLapply(cl, seq_len(iter), function(x) Maria::inventorycheckformat(inventory))


stopCluster(cl) # stop the cluster
```

